<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Live Stock Price Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/lightweight-charts@3.8.0/dist/lightweight-charts.standalone.production.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const chartOptions = {
                layout: {textColor: 'black', background: {type: 'solid', color: 'white'}},
            };
            const chartContainer = document.getElementById("chart");
            const chart = LightweightCharts.createChart(chartContainer, chartOptions);

            // ✅ Create a candlestick series
            const candlestickSeries = chart.addCandlestickSeries({
                upColor: '#26a69a', downColor: '#ef5350', borderVisible: false,
                wickUpColor: '#26a69a', wickDownColor: '#ef5350',
            });

            chart.timeScale().fitContent();

            // ✅ Connect WebSocket for live stock updates
            let socket = new WebSocket("ws://localhost:9095/stock");

            socket.onmessage = function (event) {
                let data = JSON.parse(event.data);
                let stockData = {
                    time: data.time,
                    open: data.open,
                    high: data.high,
                    low: data.low,
                    close: data.close
                };
                candlestickSeries.update(stockData);
            };

            socket.onopen = function () {
                console.log("WebSocket connected!");
            };

            socket.onerror = function (error) {
                console.error("WebSocket Error:", error);
            };
        });
    </script>
</head>
<body class="bg-dark">
<h1 class="text-warning text-center p-3 m-4">Live Stock Price Tracker (HK)</h1>
<div class="container">
    <div id="chart" class="w-100" style="height: 800px;"></div>
</div>
</body>
</html>
