<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Stock Market Trade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        // Function to handle buy stock request
        function buyStock() {
            let stockId = document.getElementById("stockBuyId").value;
            let quantity = document.getElementById("buyQuantity").value;
            let userId = document.getElementById("userId").value;

            $.ajax({
                url: '/trade/buy',
                type: 'POST',
                data: {
                    userId: userId,
                    stockId: stockId,
                    quantity: quantity
                },
                success: function (response) {
                    alert(response);  // Show success or failure message
                    location.reload(); // Optionally reload page to reflect changes
                },
                error: function () {
                    alert("Error in buying stock");
                }
            });
        }

        // Function to handle sell stock request
        function sellStock() {
            let stockId = document.getElementById("stockSellId").value;
            let quantity = document.getElementById("sellQuantity").value;
            let userId = document.getElementById("userId").value;

            $.ajax({
                url: '/trade/sell',
                type: 'POST',
                data: {
                    userId: userId,
                    stockId: stockId,
                    quantity: quantity
                },
                success: function (response) {
                    alert(response);  // Show success or failure message
                    location.reload(); // Optionally reload page to reflect changes
                },
                error: function () {
                    alert("Error in selling stock");
                }
            });
        }
    </script>
</head>
<body>
<h2>Trade Stocks</h2>

<!-- User's information (userId) -->
<input type="hidden" id="userId" th:value="${user.id}"/> <!-- Hardcoded user ID for now -->

<h3>Buy Stock</h3>
<form id="buyForm" onsubmit="event.preventDefault(); buyStock();">
    <label for="stockBuyId">Stock ID:</label>
    <input type="number" id="stockBuyId" required/><br><br>

    <label for="buyQuantity">Quantity:</label>
    <input type="number" id="buyQuantity" required/><br><br>

    <button type="submit">Buy</button>
</form>

<h3>Sell Stock</h3>
<form id="sellForm" onsubmit="event.preventDefault(); sellStock();">
    <label for="stockSellId">Stock ID:</label>
    <input type="number" id="stockSellId" required/><br><br>

    <label for="sellQuantity">Quantity:</label>
    <input type="number" id="sellQuantity" required/><br><br>

    <button type="submit">Sell</button>
</form>

</body>
</html>
